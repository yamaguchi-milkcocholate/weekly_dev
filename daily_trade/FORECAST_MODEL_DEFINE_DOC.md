# ğŸ“˜ è¦ä»¶å®šç¾©æ›¸

**ã‚·ã‚¹ãƒ†ãƒ åç§°:** 1 æ—¥ 1 ãƒˆãƒ¬ãƒ¼ãƒ‰ AI ã‚·ã‚¹ãƒ†ãƒ ï¼ˆPhase 1ï¼šæ–¹å‘äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ï¼‰

---

## 1. èƒŒæ™¯ãƒ»ç›®çš„

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€æ ªå¼å¸‚å ´ã«ãŠã‘ã‚‹ã€Œ1 æ—¥ 1 å›ã®ãƒˆãƒ¬ãƒ¼ãƒ‰æ„æ€æ±ºå®šã€ã‚’è‡ªå‹•åŒ–ã™ã‚‹ AI ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚
Phase 1 ã§ã¯ã€æœ€çµ‚çš„ãª AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£…ã®å‰æ®µéšã¨ã—ã¦ã€
**ä¾¡æ ¼æ–¹å‘äºˆæ¸¬ï¼ˆä¸Šæ˜‡ï¼ä¸‹é™ï¼‰** ã¨ **æµå‹•æ€§è©•ä¾¡ï¼ˆå‡ºæ¥é«˜ã®è¦‹è¾¼ã¿ï¼‰** ã‚’å®šé‡çš„ã«è¡Œã†ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ç¾¤ã‚’æ•´å‚™ã—ã€äººé–“ãŒãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§é‹ç”¨ã§ãã‚‹çŠ¶æ…‹ã‚’å®Ÿç¾ã™ã‚‹ã€‚

---

## 2. é–‹ç™ºã‚¹ã‚³ãƒ¼ãƒ—

| ãƒ•ã‚§ãƒ¼ã‚º | å¯¾è±¡ç¯„å›²                                                           | å‚™è€ƒ          |
| -------- | ------------------------------------------------------------------ | ------------- |
| Phase 1  | ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ç‰¹å¾´é‡æ§‹ç¯‰ã€æ–¹å‘äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ï¼ˆLightGBMï¼‰ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”Ÿæˆ | âœ… ä»Šå›ã®å¯¾è±¡ |

---

## 3. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ã€æ ªä¾¡ã® OHLCV ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã¨ã—ã€
ä»¥ä¸‹ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•å®Ÿè¡Œã§ãã‚‹ Python ãƒ™ãƒ¼ã‚¹ã®åˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æä¾›ã™ã‚‹ã€‚

```
[DataLoader]
   â†“
[Preprocessor]
   â†“
[FeatureBuilder]
   â†“
[TargetGenerator]
   â†“
[DirectionModel (LightGBM)]
   â†“
[è©•ä¾¡ãƒ»å‡ºåŠ›]
```

---

## 4. æ©Ÿèƒ½è¦ä»¶

### 4.1 DataLoader

| é …ç›® | å†…å®¹                                                                 |
| ---- | -------------------------------------------------------------------- |
| ç›®çš„ | yfinance API ã‚’ç”¨ã„ã¦ã€æŒ‡å®šéŠ˜æŸ„ã® OHLCV ãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¥è¶³ï¼‰ã‚’å–å¾—         |
| å…¥åŠ› | éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã€æœŸé–“(start/end)ã€intervalï¼ˆæ—¢å®šï¼š1dï¼‰                    |
| å‡ºåŠ› | `timestamp, symbol, open, high, low, close, volume` ã‚’å«ã‚€ DataFrame |
| è¦ä»¶ |                                                                      |

- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯ **Asia/Tokyo (JST)** ã«çµ±ä¸€
- API å‘¼å‡ºã—å¤±æ•—æ™‚ã¯ãƒªãƒˆãƒ©ã‚¤ 3 å›
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆParquet å½¢å¼ï¼‰ã¨ã—ã¦ä¿å­˜å¯èƒ½
- éŠ˜æŸ„ã”ã¨ã«æ¬ æã‚„ç•°å¸¸å€¤ï¼ˆvolume=0 ãªã©ï¼‰ã‚’ãƒ­ã‚°å‡ºåŠ›

---

### 4.2 Preprocessorï¼ˆä»»æ„ï¼‰

| é …ç›® | å†…å®¹                                         |
| ---- | -------------------------------------------- |
| ç›®çš„ | æ—¥è¶³ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ã€ç•°å¸¸å€¤è£œæ­£ã€éå–¶æ¥­æ—¥ã®å‡¦ç† |
| è¦ä»¶ |                                              |

- volume=0 ã®æ—¥ã¯æ¬ ææ‰±ã„
- æ¥µç«¯ãªå€¤å¹…ã‚’ Winsorizeï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« 1%ã€œ99%ï¼‰å¯èƒ½ãªé–¢æ•°ã‚’æä¾›
- éŠ˜æŸ„å˜ä½ã§ã‚½ãƒ¼ãƒˆãƒ»æ•´åˆ—

---

### 4.3 FeatureBuilder

| é …ç›®         | å†…å®¹                                                       |
| ------------ | ---------------------------------------------------------- |
| ç›®çš„         | OHLCV ã‹ã‚‰ç‰¹å¾´é‡ã‚’ç”Ÿæˆã—ã€ãƒ¢ãƒ‡ãƒ«å…¥åŠ›ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆ |
| å‡ºåŠ›         | å„æ—¥ Ã— éŠ˜æŸ„ã®ç‰¹å¾´é‡ DataFrame                              |
| ä»£è¡¨çš„ç‰¹å¾´é‡ |                                                            |

- ãƒˆãƒ¬ãƒ³ãƒ‰ç³»: `sma_5, sma_10, sma_20, sma_50, ema_21, slope_20`
- ãƒœãƒ©ç³»: `atr_14, atr_pct_14, stdev_20`
- å‡ºæ¥é«˜ç³»: `vol_ratio_20, tov_ratio_20`
- ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ : `ret_1d, ret_5d, ret_10d`
- å­£ç¯€æ€§: `dow(æ›œæ—¥), month(æœˆ)`
  | è¦ä»¶ |
- å…¨ã¦ã®ç‰¹å¾´é‡ã¯**t æ™‚ç‚¹ã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã§ç®—å‡º**ï¼ˆãƒªãƒ¼ã‚¯é˜²æ­¢ï¼‰
- æ¬ æã¯å­¦ç¿’æ™‚ã®ã¿ 0 åŸ‹ã‚ã€æ¨è«–æ™‚ã¯é™¤å¤–å¯
- å„åˆ—åã¯ `snake_case`ã€å˜ä½ï¼ˆ%ãªã©ï¼‰ã¯çµ±ä¸€
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯[ta](https://github.com/bukosabino/ta)ã‚’ä½¿ç”¨

---

### 4.4 TargetGeneratorï¼ˆç›®çš„å¤‰æ•°ä½œæˆï¼‰

| é …ç›® | å†…å®¹                                                         |
| ---- | ------------------------------------------------------------ |
| ç›®çš„ | ç¿Œæ—¥ã®ãƒªã‚¿ãƒ¼ãƒ³ï¼ˆnext_retï¼‰ãŠã‚ˆã³æ–¹å‘ï¼ˆä¸Šæ˜‡ or éä¸Šæ˜‡ï¼‰ã‚’ä½œæˆ |
| å‡ºåŠ› | `next_ret`, `y_up`ï¼ˆ0 or 1ï¼‰                                 |
| ä»•æ§˜ |                                                              |

- `next_ret = (next_close / close - 1)`
- `y_up = 1[next_ret > margin_pct]`
- `margin_pct` ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ï¼ˆä¾‹ï¼š0.1ã€œ0.2%ï¼‰ã§å°ã•ãªãƒã‚¤ã‚ºã‚’é™¤å¤–
- ç¿Œæ—¥ã®ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„è¡Œã¯å‰Šé™¤

---

### 4.5 DirectionModel

| é …ç›®       | å†…å®¹                                                   |
| ---------- | ------------------------------------------------------ |
| ç›®çš„       | ç¿Œæ—¥æ ªä¾¡ãŒä¸Šæ˜‡ã™ã‚‹ç¢ºç‡ã‚’å‡ºåŠ›ã™ã‚‹åˆ†é¡ãƒ¢ãƒ‡ãƒ«             |
| ä½¿ç”¨ãƒ¢ãƒ‡ãƒ« | LightGBM / CatBoostï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ LightGBMï¼‰             |
| å…¥åŠ›       | FeatureBuilder å‡ºåŠ›ï¼‹ç›®çš„å¤‰æ•°                          |
| å‡ºåŠ›       | `P_up`ï¼ˆä¸Šæ˜‡ç¢ºç‡ï¼‰, `feature_importances`, `auc_score` |
| å­¦ç¿’æ–¹å¼   | æ™‚ç³»åˆ—äº¤å·®æ¤œè¨¼ï¼ˆTimeSeriesSplitï¼‰                      |
| è©•ä¾¡æŒ‡æ¨™   | ROC-AUC, Accuracy, Precision, Recall                   |
| è¦ä»¶       |                                                        |

- å…¨ç‰¹å¾´é‡ã«æœªæ¥æƒ…å ±ãŒå«ã¾ã‚Œãªã„
- ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã¯ Optuna å¯¾å¿œå¯èƒ½
- å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã‚’ `model.pkl` ã¨ã—ã¦ä¿å­˜
- æ¨è«–æ™‚ã«éŠ˜æŸ„æ¨ªæ–­ã§ä¸€æ‹¬ç¢ºç‡ã‚’è¿”ã›ã‚‹

---

## 5. éæ©Ÿèƒ½è¦ä»¶

| åŒºåˆ†           | è¦ä»¶                                                                                                           |
| -------------- | -------------------------------------------------------------------------------------------------------------- |
| è¨€èª           | Python 3.12 ä»¥é™                                                                                               |
| ä¸»è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | pandas, numpy, yfinance, lightgbm, scikit-learn, ta                                                            |
| ãƒ‡ãƒ¼ã‚¿å½¢å¼     | Parquetï¼ˆArrow äº’æ›ï¼‰                                                                                          |
| å‡¦ç†é€Ÿåº¦       | æ—¥è¶³ 5 å¹´åˆ† Ã— ç´„ 200 éŠ˜æŸ„ã§ 30 ç§’ä»¥å†…ï¼ˆãƒ¡ãƒ¢ãƒªå†…å‡¦ç†ï¼‰                                                          |
| ä¿¡é ¼æ€§         | æ¬ æãƒ»API å¤±æ•—ãƒ»ç•°å¸¸å€¤ã®ãƒ­ã‚°ã‚’å…¨ã¦å‡ºåŠ›                                                                         |
| å†ç¾æ€§         | ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ¼ãƒ‰å›ºå®š (`random_state=42`)                                                                         |
| æ‹¡å¼µæ€§         | FeatureBuilder, Model, Backtester ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦åˆ†é›¢è¨­è¨ˆ                                                   |
| ä¿å­˜å…ˆ         | `./src/daily_trade/data/ohlcv/`, `./src/daily_trade/data/features/`, `./src/daily_trade/models/` ã® 3 éšå±¤æ§‹æˆ |

---

## 6. å…¥å‡ºåŠ›ä»•æ§˜

### å…¥åŠ›ä¾‹

```yaml
symbols:
  - 7203.T
  - 6758.T
  - 9984.T
interval: "1d"
start: "2019-01-01"
end: null
margin_pct: 0.15
```

### å‡ºåŠ›ä¾‹

| timestamp  | symbol | close  | ret_1d  | sma_20 | atr_14 | vol_ratio | next_ret | y_up |
| ---------- | ------ | ------ | ------- | ------ | ------ | --------- | -------- | ---- |
| 2025-10-17 | 7203.T | 2438.5 | 0.0012  | 2422.3 | 25.4   | 1.23      | 0.0042   | 1    |
| 2025-10-17 | 6758.T | 14320  | -0.0021 | 14260  | 158.3  | 0.95      | -0.0013  | 0    |

---

## 7. ã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼ãƒ­ã‚°è¦ä»¶

| äº‹è±¡       | å¯¾å¿œ                                 |
| ---------- | ------------------------------------ |
| API å¤±æ•—   | 3 å›ãƒªãƒˆãƒ©ã‚¤å¾Œã€è­¦å‘Šãƒ­ã‚°å‡ºåŠ›         |
| ãƒ‡ãƒ¼ã‚¿æ¬ æ | NaN ã®ã¾ã¾ä¿æŒã€å­¦ç¿’æ™‚ã« 0 åŸ‹ã‚      |
| ç•°å¸¸å€¤     | å€¤å¹…åˆ¶é™è¶…éã¯ winsorizeï¼ˆè¨˜éŒ²ä»˜ãï¼‰ |
| ä¿å­˜å¤±æ•—   | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¨ä¾‹å¤–ã‚’ãƒ­ã‚°å‡ºåŠ›         |

ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆä¾‹ï¼‰ï¼š

```
[2025-10-25 10:03:21] WARN: Missing data for 6758.T on 2021-12-30
[2025-10-25 10:03:25] INFO: Features built for 5 symbols (records=6200)
```

---

## 8. æˆæœç‰©ä¸€è¦§

| ç¨®åˆ¥           | ãƒ•ã‚¡ã‚¤ãƒ«å                     | èª¬æ˜                                            |
| -------------- | ------------------------------ | ----------------------------------------------- |
| ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰   | `data_pipeline.py`             | DataLoader / FeatureBuilder / Target ä½œæˆã‚¯ãƒ©ã‚¹ |
| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ     | `train_direction_model.py`     | å­¦ç¿’ãƒ»è©•ä¾¡ç”¨                                    |
| è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«   | `config_feature.yaml`          | ç‰¹å¾´é‡æ§‹æˆãƒ»é–¾å€¤è¨­å®š                            |
| å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿     | `daily_ohlcv_features.parquet` | ç‰¹å¾´é‡ä»˜ããƒ‡ãƒ¼ã‚¿                                |
| å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ« | `direction_model.pkl`          | LightGBM ãƒ¢ãƒ‡ãƒ«                                 |
| ãƒ­ã‚°           | `logs/run_YYYYMMDD.log`        | å®Ÿè¡Œãƒ­ã‚°                                        |

---

## 9. å®Œæˆæ¡ä»¶ï¼ˆDone Criteriaï¼‰

- [x] 5 å¹´ä»¥ä¸Šã® OHLCV ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å–å¾—ãƒ»ä¿å­˜å¯èƒ½
- [x] ç‰¹å¾´é‡ 20 ç¨®ä»¥ä¸Šã‚’ t æ™‚ç‚¹æƒ…å ±ã®ã¿ã§ç”Ÿæˆ
- [x] ç¿Œæ—¥æ–¹å‘ã®äºŒå€¤åˆ†é¡ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã— AUC>0.55 ä»¥ä¸Š
- [x] ç‰¹å¾´é‡ãƒ»ãƒ¢ãƒ‡ãƒ«ãŒ Parquet/pkl ã§å†ç¾å¯èƒ½
- [x] å®Ÿè¡Œãƒ­ã‚°ãƒ»å†ç¾æ‰‹é †ãŒæ˜ç¢ºã«æ®‹ã‚‹

---

## 10. ãƒ‡ãƒ¼ã‚¿è¦ä»¶ï¼ˆå¥‘ç´„ãƒ»å“è³ªãƒã‚§ãƒƒã‚¯ï¼‰

### 10.1 ãƒ‡ãƒ¼ã‚¿å¥‘ç´„ï¼ˆData Contractï¼‰

- **åˆ—ãƒ»å‹**

  - `timestamp: datetime64[ns, Asia/Tokyo]`ï¼ˆå–¶æ¥­æ—¥çµ‚å€¤ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
  - `symbol: string`
  - `open, high, low, close: float64`ï¼ˆéè² ã€`high>=max(open,close)`, `low<=min(open,close)`, `high>=low`ï¼‰
  - `volume: int64`ï¼ˆ`>=0`ï¼‰

- **èª¿æ•´å€¤ã®æ–¹é‡**

  - ãƒªã‚¿ãƒ¼ãƒ³è¨ˆç®—ã«ã¯ **Adjusted Close** ã‚’ä½¿ç”¨ï¼ˆé…å½“/åˆ†å‰²èª¿æ•´ï¼‰ã€‚
    å–å¾—ç³»ã§ã¯ `adj_close` ã‚’ä½µç½®ã—ã€`close` ã¯è¡¨ç¤º/æ¤œè¨¼ç”¨é€”ã¨ã™ã‚‹ã€‚

- **ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼**

  - ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯ **Asia/Tokyo** ã§çµ±ä¸€ã€‚DST ã¯ç„¡ã—ã€‚
  - ç¥æ—¥/è‡¨æ™‚ä¼‘å ´ã¯æ¬ æï¼ˆ**åŸ‹ã‚ãªã„**ï¼‰ã€‚`rolling(min_periods=â€¦)`ã§å¸åã€‚

- **ãƒ¦ãƒ‹ãƒãƒ¼ã‚¹å®šç¾©**

  - Phase 1 ã¯å›ºå®šãƒ¦ãƒ‹ãƒãƒ¼ã‚¹ï¼ˆä¾‹ï¼šTOPIX Core30 ç­‰ï¼‰ã§**ã‚µãƒã‚¤ãƒãƒ¼ã‚·ãƒƒãƒ—ãƒ»ãƒã‚¤ã‚¢ã‚¹**ã®å½±éŸ¿ã‚’æ˜ç¤ºã€‚
  - å°†æ¥ã¯**æ—¥ä»˜æ™‚ç‚¹ãƒ¦ãƒ‹ãƒãƒ¼ã‚¹**ï¼ˆæ§‹æˆéŠ˜æŸ„ã®å¤‰é·ã‚’åæ˜ ï¼‰ã¸æ‹¡å¼µã€‚

### 10.2 ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆå®Ÿè¡Œæ™‚ã«å¿…é ˆï¼‰

- é‡è¤‡ `timestamp,symbol` è¡Œã¯ã‚¨ãƒ©ãƒ¼ã€‚
- `volume=0` ã¯**å­¦ç¿’ã‚µãƒ³ãƒ—ãƒ«ã‹ã‚‰é™¤å¤–**ï¼ˆè¦ãƒ­ã‚°ï¼‰ã€‚
- ç•°å¸¸å€¤æ¤œå‡ºï¼š

  - å½“æ—¥å€¤å¹…ãŒ**ç›´è¿‘ 60 æ—¥ä¸­å¤®å€¤ã® Â±10Ïƒ**è¶… â†’ è­¦å‘Šãƒ­ã‚°ï¼‹ winsorize å¯¾è±¡ã€‚

- ä¼æ¥­ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåˆ†å‰²ãƒ»ä½µåˆï¼‰æ¤œçŸ¥ï¼š`adj_close/close` æ¯”ã®æ€¥å¤‰ã§ãƒ•ãƒ©ã‚°ã€‚

---

## 11. FeatureBuilder ã® `ta` æŒ‡æ¨™ãƒãƒƒãƒ”ãƒ³ã‚°

| è¦ä»¶æ›¸ã®åˆ—å    | `ta` ãƒ©ã‚¤ãƒ–ãƒ©ãƒª                                                                    | è¨ˆç®—å¼/æ³¨æ„          |
| --------------- | ---------------------------------------------------------------------------------- | -------------------- |
| `sma_N`         | `ta.trend.SMAIndicator(close, window=N).sma_indicator()`                           | Nâˆˆ{5,10,20,50}       |
| `ema_21`        | `ta.trend.EMAIndicator(close, window=21).ema_indicator()`                          |                      |
| `atr_14`        | `ta.volatility.AverageTrueRange(high, low, close, window=14).average_true_range()` | TR ã® EMA ç‰ˆã§å¯     |
| `atr_pct_14`    | ä¸Šè¨˜ / `close`                                                                     | å˜ä½ã¯ **æ¯”ç‡**      |
| `stdev_20`      | `close.pct_change().rolling(20).std()`                                             | åç›Šç‡ã® Ïƒ           |
| `ret_1d,5d,10d` | `close.pct_change(n)`                                                              | `adj_close`æ¨å¥¨      |
| `vol_ratio_20`  | `volume / volume.rolling(20).mean()`                                               |                      |
| `tov_ratio_20`  | `(close*volume) / (rolling_mean(close*volume,20))`                                 |                      |
| `slope_20`      | è¿‘ä¼¼ï¼š`SMA_20.diff()/20` ã¾ãŸã¯ `scipy.stats.linregress`                           | å¾Œè€…ã¯å³å¯†å›å¸°       |
| `dow, month`    | `timestamp.dt.weekday`, `timestamp.dt.month`                                       | One-hot ã¯å­¦ç¿’å´ã§å¯ |

> ã™ã¹ã¦**æ™‚ç‚¹ t ã¾ã§ã®æƒ…å ±**ã§ç®—å‡ºã€‚`shift(-1)`ã¯**ç›®çš„å¤‰æ•°ä½œæˆã®ã¿ã«é™å®š**ã€‚

---

## 12. å­¦ç¿’ãƒ»è©•ä¾¡è¦ä»¶ï¼ˆè©³ç´°ï¼‰

- **æ™‚ç³»åˆ— CV**ï¼š`TimeSeriesSplit(n_splits=5)`ï¼ˆå±¤åˆ¥ãªã—ï¼‰ã€‚
  å¯èƒ½ãªã‚‰**Purged K-Fold**ï¼ˆé‡è¤‡æƒ…å ±ã®â€œãƒ‘ãƒ¼ã‚¸/ã‚¨ãƒ³ãƒã‚´â€ï¼‰å¯¾å¿œã‚’è¨­è¨ˆæ›¸ã«æ®‹ã™ã€‚
- **è©•ä¾¡ KPIï¼ˆPhase 1 ã®åˆæ ¼åŸºæº–ï¼‰**

  - æ–¹å‘ AUC â‰¥ **0.55**
  - ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èª¤å·®ï¼ˆBrier scoreï¼‰â‰¦ **åŸºæº–æ¨¡å‹ï¼ˆ0/1 ä¹±æ•°ï¼‰æ¯”ã§-5%ä»¥ä¸Š**
  - ç›´è¿‘ 1 å¹´ã¨å…¨æœŸé–“ã®å·®ï¼ˆAUC ãƒ‰ãƒªãƒ•ãƒˆï¼‰â‰¦ **0.05**

- **ãƒ¢ãƒ‡ãƒ«è§£é‡ˆ**

  - `feature_importances_` å‡ºåŠ›å¿…é ˆã€‚
  - ä¸»è¦ç‰¹å¾´é‡ TOP10 ã¨ SHAP è¦ç´„ï¼ˆ1000 ã‚µãƒ³ãƒ—ãƒ«ï¼‰ã‚’ PNG å‡ºåŠ›ï¼ˆä»»æ„ï¼‰ã€‚

---

## 13. ãƒ†ã‚¹ãƒˆè¦ä»¶

- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**ï¼ˆæœ€ä½é™ï¼‰

  - FeatureBuilderï¼šå„åˆ—ã®**éè² /æœ‰ç•Œ**ã€`atr_pct_14âˆˆ[0,1]`ã€NA ç‡ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯ã€‚
  - TargetGeneratorï¼š`next_ret` ã®**é NA ç‡=ï¼ˆç·è¡Œ-éŠ˜æŸ„æ•°ï¼‰**ã€`y_upâˆˆ{0,1}`ã€‚

- **çµ±åˆãƒ†ã‚¹ãƒˆ**

  - 5 éŠ˜æŸ„ Ã—3 å¹´ã§**30 ç§’ä»¥å†…**ï¼ˆApple M ç³»åˆ—ç›®å®‰ï¼‰ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œèµ°ã€‚

- **å›å¸°ãƒ†ã‚¹ãƒˆ**

  - åŒä¸€å…¥åŠ›ã«å¯¾ã—ã€ç‰¹å¾´é‡/ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ/ãƒ¢ãƒ‡ãƒ«ã‚¹ã‚³ã‚¢ãŒ**bit-identical**ï¼ˆä¹±æ•° seed å›ºå®šï¼‰ã€‚

---

## 14. é‹ç”¨ãƒ»ç›£è¦–ï¼ˆPhase 1 æ™‚ç‚¹ï¼‰

- **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**

  - `./src/daily_trade/data/ohlcv/` â€¦ åŸãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¥ä»˜ãƒ»éŠ˜æŸ„åˆ¥ Parquetï¼‰
  - `./src/daily_trade/data/features/` â€¦ ç‰¹å¾´é‡ãƒ†ãƒ¼ãƒ–ãƒ«
  - `./src/daily_trade/models/` â€¦ `direction_model.pkl`
  - `./logs/` â€¦ å®Ÿè¡Œãƒ­ã‚°

- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**

  - ä¾å­˜ã¯ `uv/poetry` ã§**å³å¯† pin**ã€‚`requirements-lock.txt`ã‚’ä¿å­˜ã€‚

- **ç›£è¦–**

  - å®Ÿè¡Œã”ã¨ã«ã€Œæ¬ æç‡ãƒ»ç•°å¸¸å€¤ä»¶æ•°ãƒ»AUCã€ã‚’ Slack ã¸è¦ç´„é€šçŸ¥ï¼ˆå°†æ¥ Phase 2 ã§æ‹¡å¼µï¼‰ã€‚

---

## 15. ãƒªã‚¹ã‚¯ã¨åˆ¶ç´„

- **API ä¾å­˜**ï¼š`yfinance` ã®ä»•æ§˜å¤‰æ›´/æ¬ æã€‚â†’ ä»£æ›¿ï¼ˆæ ªæ¢/QUICK/ã‚¢ãƒ«ãƒ‘ã‚«ç­‰ï¼‰ã¸å·®ã—æ›¿ãˆå¯èƒ½ã«æŠ½è±¡åŒ–ã€‚
- **ã‚µãƒã‚¤ãƒãƒ¼ã‚·ãƒƒãƒ—ãƒ»ãƒã‚¤ã‚¢ã‚¹**ï¼šå›ºå®šãƒ¦ãƒ‹ãƒãƒ¼ã‚¹ã®ãŸã‚çµ±è¨ˆã«åã‚Šã€‚â†’ å¾Œç¶šãƒ•ã‚§ãƒ¼ã‚ºã§ä¿®æ­£ã€‚
- **éå­¦ç¿’**ï¼šæŒ‡æ¨™ã‚’å¢—ã‚„ã—ã™ããªã„ã€Optuna ã®æ¢ç´¢ç¯„å›²ã«**æ­£å‰‡åŒ–é‡è¦–**ã®ä¸Šé™ã‚’è¨­å®šã€‚

---

## 16. ã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼ˆå†ç¾æ‰‹é †ï¼‰

```bash
# 1) å–å¾—ã€œç‰¹å¾´é‡ã€œç›®çš„å¤‰æ•°
python -m daily_trade.scripts.build_dataset \
  --symbols 7203.T 6758.T 9984.T 8035.T 9432.T \
  --start 2019-01-01 --end 2025-10-24 \
  --interval 1d --out ./src/daily_trade/data/features/daily_ohlcv_features.parquet

# 2) å­¦ç¿’ï¼ˆæ™‚ç³»åˆ—CVï¼‰
python -m daily_trade.scripts.train_direction_model \
  --in ./src/daily_trade/data/features/daily_ohlcv_features.parquet \
  --model-out ./src/daily_trade/models/direction_model.pkl \
  --report-out ./logs/train_report_$(date +%Y%m%d).json
```

---

## 17. ä»˜éŒ²ï¼šç‰¹å¾´é‡ã‚¹ã‚­ãƒ¼ãƒï¼ˆå‹ãƒ»å˜ä½ï¼‰

| åˆ—å           | å‹      | å˜ä½/ãƒ¬ãƒ³ã‚¸   | å‚™è€ƒ              |
| -------------- | ------- | ------------- | ----------------- |
| `ret_1d`       | float64 | æ¯”ç‡ï¼ˆ-1â€¦+âˆï¼‰ | `adj_close`ãƒ™ãƒ¼ã‚¹ |
| `atr_14`       | float64 | ä¾¡æ ¼          |                   |
| `atr_pct_14`   | float64 | æ¯”ç‡ï¼ˆ0â€¦1ï¼‰   | `atr_14 / close`  |
| `stdev_20`     | float64 | æ¯”ç‡          |                   |
| `vol_ratio_20` | float64 | å€ç‡ï¼ˆ0â€¦âˆï¼‰   |                   |
| `tov_ratio_20` | float64 | å€ç‡ï¼ˆ0â€¦âˆï¼‰   |                   |
| `slope_20`     | float64 | ä¾¡æ ¼/æ—¥       | è¿‘ä¼¼å¯            |
| `slope_pct_20` | float64 | æ¯”ç‡/æ—¥       |                   |
| `dow`          | int8    | 0..6          |                   |
| `month`        | int8    | 1..12         |                   |

---
