# 実験006: 正則化強化による過学習完全抑制

# 入出力設定
input_path: "data/ohlcv/latest_dataset.parquet"
output_path: "models/exp_006_regularization.pkl"
cv_splits: 5

# モデル設定 (正則化大幅強化)
model_params:
  # 基本パラメータ
  n_estimators: 300 # 500→300に削減
  learning_rate: 0.03 # 0.05→0.03にさらに保守的

  # 過学習抑制パラメータ (さらに強化)
  max_depth: 3 # 4→3に削減
  num_leaves: 10 # 15→10に削減
  min_child_samples: 100 # 50→100に増加
  subsample: 0.7 # 0.8→0.7に削減
  colsample_bytree: 0.7 # 0.8→0.7に削減

  # 正則化パラメータ (大幅強化)
  reg_alpha: 0.3 # 0.1→0.3に強化
  reg_lambda: 0.3 # 0.1→0.3に強化

  # 追加の正則化
  min_split_gain: 0.1 # 分割ゲイン最小値
  min_child_weight: 0.1 # 子ノード重み最小値

  # その他
  random_state: 42
  early_stopping_rounds: 30 # 50→30に短縮
  verbose: -1

# 特徴量工学設定 (実験005bベース)
feature_engineering:
  # 相互作用項 (金融理論に基づく組み合わせ)
  interaction_features:
    # ボラティリティ × モメンタム
    - ["atr_pct_14", "rsi_14"] # 変動率とRSIの相互作用
    - ["stdev_20", "ret_1d"] # 標準偏差と短期リターン
    - ["bb_width_20", "macd"] # ボリンジャーバンド幅とMACD

    # ボリューム × 価格
    - ["vol_ratio_20", "ret_5d"] # 出来高比率と中期リターン
    - ["tov_ratio_20", "bb_pband_20"] # 売買代金比率とボリンジャー位置

    # 時系列 × 技術指標
    - ["dow", "atr_pct_14"] # 曜日効果とボラティリティ

  # 非線形変換
  nonlinear_transforms:
    # 対数変換 (裾の長い分布を正規化)
    log_features:
      - "atr_pct_14"
      - "vol_ratio_20"
      - "tov_ratio_20"

    # 平方根変換 (ボラティリティ系)
    sqrt_features:
      - "stdev_20"
      - "bb_width_20"

    # ランク変換 (外れ値耐性)
    rank_features:
      - "ret_1d"
      - "ret_5d"
      - "ret_10d"

  # ドメイン知識特徴量
  domain_features:
    # 金融理論ベース
    momentum_strength: true # モメンタム強度 = |rsi_14 - 50|
    volatility_regime: true # ボラティリティ局面 = atr_pct_14のランク
    trend_consistency: true # トレンド一貫性 = slope方向とmacd方向の一致
    volume_spike: true # 出来高急増 = vol_ratio_20 > 2.0
    oversold_oversold: true # 売られすぎ = rsi_14 < 30
    overbought: true # 買われすぎ = rsi_14 > 70

    # 複合指標
    technical_score: true # 技術指標総合スコア
    risk_score: true # リスクスコア (ボラティリティ関連)

# 特徴量選択設定 (より厳格化)
feature_selection:
  # 除外特徴量 (非定常・低予測力・情報漏洩・擬似相関)
  exclude_features:
    - "month" # 非定常
    - "quarter" # 非定常
    - "contains_leading_nan" # 非定常
    - "next_ret" # 情報漏洩（未来の情報）
    - "day_of_month" # 擬似相関の可能性

  # 相関フィルタリング (厳格化)
  correlation_threshold: 0.90 # 0.95→0.90に厳格化

  # 重要度フィルタリング
  importance_threshold: 0.001 # 重要度が閾値以下の特徴量を除去

# ログ設定
logging:
  level: "INFO"
  log_file: "logs/exp_006_regularization.log"
